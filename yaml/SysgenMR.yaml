##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file.
##############################################################################
#schemaversion 3.0.0
#once

SysgenMR: &SysgenMR 
  description: "Sysgen MR Module"
  class: MMIODev
  configPrio: 1
  size: 0x1000 
  #########
  children:
  #########
    #########################################################
    Status:
      class: IntField
      at:
        offset: 0x000
        nelms: 10
      mode: RO
      description: "Status registers"
    #########################################################
    Mux1:
      class: IntField
      at:
        offset: 0x800
      sizeBits: 1
      lsBit: 0
      mode: RW
      description: "LO DAC control 0 for PLL 1 for manual"
    #########################################################
    Mux2:
      class: IntField
      at:
        offset: 0x800
      sizeBits: 1
      lsBit: 1
      mode: RW
      description: "CLK DAC control 0 for PLL 1 for manual"
    #########################################################
    Mux3:
      class: IntField
      at:
        offset: 0x800
      sizeBits: 2
      lsBit: 2
      mode: RW
      description: "Monitor DAC control 0: LO PLL vco 1: LO PLL PD 2: CLK PLL vco 3: CLK PLL PD"
    #########################################################
    IF_FF_ENABLE:
      class: IntField
      at:
        offset: 0x800
      sizeBits: 2
      lsBit: 4
      mode: RW
      description: "IF FF enable 0: Off 1: On positive polarity 2: On negative polarity 3: On negative polarity"
    #########################################################
    LO_REF_ADC_SEL:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 0
      mode: RW
      description: "LO ref ADC select 0: ADC 0_5 1: ADC 1_0"
    #########################################################
    CLK_REF_ADC_SEL:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 1
      mode: RW
      description: "CLK ref ADC select 0: ADC 1_5 1: ADC 1_4"
    #########################################################
    ORDER_MUX:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 2
      mode: RW
      description: "DAC OUT ORDER MUX"
    #########################################################
    ADC_ORDER_MUX:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 3
      mode: RW
      description: "ADC IN ORDER MUX"
    #########################################################
    CLK_RECOVER_MUX:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 4
      mode: RW
      description: "0 use ADPLL 1 use LUT"
    #########################################################
    DDS_RESET:
      class: IntField
      at:
        offset: 0x801
      sizeBits: 1
      lsBit: 5
      mode: RW
      description: "Active low DDS RESET"
    #########################################################
    CH_MUX :
      class: IntField
      at:
        offset: 0x802
      sizeBits: 3
      lsBit: 0
      mode: RW
      description: "MUX for PIPELINED DDC"
    #########################################################
    DDC_CLK_MUX :
      class: IntField
      at:
        offset: 0x802
      sizeBits: 1
      lsBit: 3
      mode: RW
      description: "MUX for CLK PD DDC"
    #########################################################
    DLO_SEL:
      class: IntField
      at:
        offset: 0x802
      sizeBits: 1
      lsBit: 4
      mode: RW
      description: "Digital LO SEL, 0 fixed, 1 ADPLL"
    #########################################################:
    ERR_RESET:
      class: IntField
      at:
        offset: 0x802
      sizeBits: 1
      lsBit: 5
      mode: RW
      description: "Repeat error reset"
    #########################################################
    LovcoDACSet:
      class: IntField
      at:
        offset: 0x804
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "manual DAC settings for LO VCO (signed)"
    #########################################################
    IFsetI:
      class: IntField
      at:
        offset: 0x808
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "IFSet I signed"
    #########################################################
    IFsetQ:
      class: IntField
      at:
        offset: 0x80A
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "IFSet Q signed"
    #########################################################
    LOPhaseSet:
      class: IntField
      at:
        offset: 0x80C
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "Lo phase set signed"
    #########################################################
    CkvcoDACSet:
      class: IntField
      at:
        offset: 0x810
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "manual settings for clock VCO (signed)"
    #########################################################
    LO_KP:
      class: IntField
      at:
        offset: 0x814
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "LO loop P term gain"
    #########################################################
    LO_KI:
      class: IntField
      at:
        offset: 0x816
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "LO loop I term"
    #########################################################
    CLK_KP:
      class: IntField
      at:
        offset: 0x818
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "CLK loop P term"
    #########################################################
    CLK_KI:
      class: IntField
      at:
        offset: 0x81A
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "CLK loop I term"
    #########################################################
    ADPLL_KI:
      class: IntField
      at:
        offset: 0x81C
      sizeBits: 32
      lsBit: 0
      mode: RW
      description: "ADPLL loop I term"
    #########################################################
    ADPLL:
      class: IntField
      at:
        offset: 0x820
      sizeBits: 32
      lsBit: 0
      mode: RW
      description: "ADPLL loop P term"
    #########################################################
    CK_DIVIDE:
      class: IntField
      at:
        offset: 0x828
      sizeBits: 16
      lsBit: 0
      mode: RW
      description: "CLK DIVIDE"
    #########################################################
    BAY0_GAIN:
      class: IntField
      at:
        offset: 0x82C
      sizeBits: 8
      lsBit: 0
      mode: RW
      description: "Bay0 GAIN, u8_4"
    #########################################################
    BAY1_GAIN:
      class: IntField
      at:
        offset: 0x82D
      sizeBits: 8
      lsBit: 0
      mode: RW
      description: "Bay1 GAIN, u8_4"
    #########################################################
    LO_REF_SEL:
      class: IntField
      at:
        offset: 0x82E
      sizeBits: 3
      lsBit: 0
      mode: RW
      description: "LO REF SEL, for PLL + ADPLL"
    #########################################################
    RFPulseLength:
      class: IntField
      at:
        offset: 0x830
      sizeBits: 32
      mode: RW
      description: "RF pulse length, 357MHz counts"
    #########################################################
    ReferenceChannel:
      class: IntField
      at:
        offset: 0x834
      sizeBits: 4
      mode: RW
      enums:
        - name: Ch0
          value: 0
        - name: Ch1
          value: 1
        - name: Ch2
          value: 2
        - name: Ch3
          value: 3
        - name: Ch4
          value: 4
        - name: Ch5
          value: 5
    #########################################################
    FeedbackChannel:
      class: IntField
      at:
        offset: 0x838
      sizeBits: 4
      mode: RW
      enums:
        - name: Ch0
          value: 0
        - name: Ch1
          value: 1
        - name: Ch2
          value: 2
        - name: Ch3
          value: 3
        - name: Ch4
          value: 4
        - name: Ch5
          value: 5
      description: "RF feedback channel"
    #########################################################
    FeedbackRotI:
      class: IntField
      at:
        offset: 0x83C
      sizeBits: 32
      mode: RW
      description: "Rotation coefficient for feedback channel"
    #########################################################
    FeedbackRotQ:
      class: IntField
      at:
        offset: 0x840
      sizeBits: 32
      mode: RW
      description: "Rotation coefficient for actuation signal"
    #########################################################
    ActuationRotI:
      class: IntField
      at:
        offset: 0x844
      sizeBits: 16
      mode: RW
      description: "Rotation coefficient for actuation signal"
    #########################################################
    ActuationRotQ:
      class: IntField
      at:
        offset: 0x848
      sizeBits: 16
      mode: RW
      description: "Rotation coefficient for actuation signal"
    #########################################################
    FeedforwardP:
      class: IntField
      at:
        offset: 0x84C
      sizeBits: 32
      mode: RW
      description: "Feedforward value"
    #########################################################
    FeedforwardA:
      class: IntField
      at:
        offset: 0x850
      sizeBits: 32
      mode: RW
      description: "Feedforward value"
    #########################################################
    GainP:
      class: IntField
      at:
        offset: 0x854
      sizeBits: 32
      mode: RW
      description: "feedback gain I"
    #########################################################
    GainA:
      class: IntField
      at:
        offset: 0x858
      sizeBits: 32
      mode: RW
      description: "feedback gain Q"
    #########################################################
    FeedbackCorrLimitP:
      class: IntField
      at:
        offset: 0x85C
      sizeBits: 32
      mode: RW
      description: "Feedback correction limit I"
    #########################################################
    FeedbackCorrLimitA:
      class: IntField
      at:
        offset: 0x860
      sizeBits: 32
      mode: RW
      description: "Feedback correction limit Q"
    #########################################################
    IntegrationStart:
      class: IntField
      at:
        offset: 0x864
      sizeBits: 32
      mode: RW
      description: "Integration period start, 357/64 MHz counts"
    #########################################################
    IntegrationEnd:
      class: IntField
      at:
        offset: 0x868
      sizeBits: 32
      mode: RW
      description: "Integration period end, 357/64 MHz counts"
    #########################################################
    ApplyCorrStart:
      class: IntField
      at:
        offset: 0x86C
      sizeBits: 32
      mode: RW
      description: "Apply correction period start, 357 MHz counts"
    #########################################################
    ApplyCorrEnd:
      class: IntField
      at:
        offset: 0x870
      sizeBits: 32
      mode: RW
      description: "Apply correction period end, 357 MHz counts"
    #########################################################
    DACOffset:
      class: IntField
      at:
        offset: 0x874
      sizeBits: 16
      mode: RW
      description: "DAC offset, counts"
    #########################################################
    DACLimitHi:
      class: IntField
      at:
        offset: 0x878
      sizeBits: 16
      mode: RW
      description: "DAC output limit high"
    #########################################################
    DACLimitLow:
      class: IntField
      at:
        offset: 0x87C
      sizeBits: 16
      mode: RW
      description: "DAC output limit low"
    #########################################################
    SetpointTableNelms:
      class: IntField
      at:
        offset: 0x880
      sizeBits: 16
      mode: RW
      description: "Setpoint table number of elements"
    #########################################################
    NonIQCoefOffset:
      class: IntField
      at:
        offset: 0x884
      sizeBits: 6
      mode: RW
      description: "Non IQ coefficient offset 0-20"
    #########################################################
    TriggerMode:
      class: IntField
      at:
        offset: 0x888
      sizeBits: 3
      mode: RW
      enums:
        - name: AccelORStandby
          value: 0
        - name: StandbyORSpare
          value: 1
        - name: Accel
          value: 2
        - name: Standby
          value: 3
        - name: Spare
          value: 4
      description: "Measured trigger period, 357 MHz counts"
    #########################################################
    ReferencePhaseSet:
      class: IntField
      at:
        offset: 0x88C
      sizeBits: 6
      mode: RW
      description: "Reference phase setpoint"
    #########################################################
    SoftwareFbkSel:
      class: IntField
      at:
        offset: 0x890
      sizeBits: 1
      mode: RW
      description: "Software feedback select"
      enums:
        - name: Firmware
          value: 0
        - name: Software
          value: 1
    #########################################################
    ICorrSoftware:
      class: IntField
      at:
        offset: 0x898
      sizeBits: 32
      mode: RW
      description: "I correct software, Fix32_30"
    #########################################################
    QCorrSoftware:
      class: IntField
      at:
        offset: 0x894
      sizeBits: 32
      mode: RW
      description: "Q correct software, Fix32_30"
    #########################################################
    OutputEnable:
      class: IntField
      at:
        offset: 0x89C
      sizeBits: 1
      mode: RW
      description: "Enable output"
      enums:
        - name: "Disabled"
          value: 0
        - name: "Enabled"
          value: 1
    #########################################################
    CWModeEnable:
      class: IntField
      at:
        offset: 0x8A0
      sizeBits: 1
      mode: RW
      description: "Enable CW mode"
      enums:
        - name: "Pulsed mode"
          value: 0
        - name: "CW mode"
          value: 1
    #########################################################
    DEBUG_SEL:
      class: IntField
      at:
        offset: 0x8A4
      sizeBits: 1
      mode: RW
      description: "Debug select, 0 debug, 1 IF out"
    #########################################################
    PhaseGain:
      class: IntField
      at:
        offset: 0x8A8
      sizeBits: 32
      mode: RW
      description: "Phase gain, Fix32_30"
    #########################################################
    PhaseFeedforward:
      class: IntField
      at:
        offset: 0x8AC
      sizeBits: 32
      mode: RW
      description: "Phase feedforward, Fix32_30"
    #########################################################
    DEBUG_SEL1:
      class: IntField
      at:
        offset: 0x8B0
      sizeBits: 1
      mode: RW
      description: "Debug select 1"
    #########################################################
    SHIFT_SEL:
      class: IntField
      at:
        offset: 0x8B4
      sizeBits: 2
      mode: RW
      description: "Enable/select barrel shift output mode, mode1/mode2 will likely have to be selected at runtime based on scope observations"
      enums:
        - name: Off
          value: 0
        - name: Mode1
          value: 0
        - name: Mode2
          value: 0
        
    #########################################################
    MajorVersion:
      class: IntField
      at:
        offset: 0x28
      sizeBits: 16
      mode: RO
      description: "Major version number"
    #########################################################
    MinorVersion:
      class: IntField
      at:
        offset: 0x2C
      sizeBits: 16
      mode: RO
      description: "Minor version number"
    #########################################################
    MeasuredTrigPeriod:
      class: IntField
      at:
        offset: 0x30
      sizeBits: 32
      mode: RO
      description: "Measured trigger period, 357 MHz counts"
    #########################################################
    TriggerCounter:
      class: IntField
      at:
        offset: 0x34
      sizeBits: 32
      mode: RO
      description: "32 bit trigger counter, since reset"
    #########################################################
    NonIQCoefLatch:
      class: IntField
      at:
        offset: 0x38
      sizeBits: 6
      mode: RO
      description: "Non IQ coefficient latch 0-20"
    #########################################################
    PhaseRot:
      class: IntField
      at:
        offset: 0x38
      sizeBits: 32
      mode: RO
      description: "Phase rot Fix32_0"
    trigOffsetCounter:
      class: IntField
      at:
        offset: 0x48
      sizeBits: 32
      mode: RO
      description: "Phase rot Fix32_0"
    trigMeas:
      class: IntField
      at:
        offset: 0x50
      sizeBits: 32
      mode: RO
      description: "Phase rot Fix32_0"
